<!doctype html>
<html lang = "en-US">
<head>
    <meta charset="UTF-8"> 
    <title>Polygam</title>
    <link rel = "stylesheet" type = "text/css"href = "styles.css" />
    <script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101196824);</script>
    <script async src="//static.getclicky.com/js"></script>
</head>

<body>
<div class="container">
    
    <div class="header">
        <span class="polygam-bw">polygam</span><span class="polygam-bw-version">v0.3</span>
    </div>
    
    <div class="content">
        loading
    </div>
</div>

<script>    

    let srcs = [];

    if(false) // true for dev
    {
        srcs = [
        "resources/d3.v5.min.js",       
        "resources/Tone.js",  
        "resources/jsmidgen.js",
        "src/D3graph.js",
        "src/polygam-icons.js",
        "src/polygam-button.js",
        "src/polygam-knob.js",
        "src/polygam-playstop.js",
        "src/polygam-oscillator.js",
        "src/polygam-note.js",
        "src/polygam-chord.js",
        "src/polygam-progression.js",
        "src/tonnetze.js",
        "src/polygam-harmony.js",
        "src/polygam-graph.js",
        "src/polygam-player.js",
        "src/polygam-sequencer.js",
        "src/polygam-app.js"
        ];  

        document.querySelector(".polygam-bw-version").innerHTML = "dev"
    }
    else
    {
        srcs = [
        "https://raw.githack.com/dorev/polygam/master/resources/d3.v5.min.js",
        "https://raw.githack.com/dorev/polygam/master/resources/Tone.js",
        "https://raw.githack.com/dorev/polygam/master/resources/jsmidgen.js",
        "https://raw.githack.com/dorev/polygam/master/src/D3graph.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-icons.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-button.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-knob.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-playstop.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-oscillator.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-note.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-chord.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-progression.js",
        "https://raw.githack.com/dorev/polygam/master/src/tonnetze.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-harmony.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-graph.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-player.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-sequencer.js",
        "https://raw.githack.com/dorev/polygam/master/src/polygam-app.js"
        ];  
    }

    let timestamp;    
    let head = document.querySelector("head");
    let content = document.querySelector(".content");

    function init(sources, callback)
    {
        if(!sources.length)
        {
            callback();
            return;
        }
        
        let source = sources.shift();    
        timestamp = Date.now();
        
        //content.innerHTML += `Loading ${source}`;
        let e = document.createElement("script");
        e.setAttribute("src", source);
        e.setAttribute("type", "text/javascript");
        head.appendChild(e);
        
        e.addEventListener('load', () => 
        {
            //content.innerHTML += ` (${Date.now() - timestamp}ms)<br>`;
            content.innerHTML += ".";
            init(sources, callback);
        });
    }
    
    function isLoaded()
    {
        content.innerHTML = "";
        content.appendChild(document.createElement("polygam-app"));
    }
    
    window.onload = init(srcs, isLoaded);    
</script>

</body>
</html>
